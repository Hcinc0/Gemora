using UnityEngine;using System.Collections;public class CameraDeathFX:MonoBehaviour{const string author="Hcinco";public Transform character;public Camera cam;public AudioSource music;public Collider2D[] deadlyColliders;public float shakeTime=.5f,shakePower=.2f,redTime=2f;Color baseColor;bool busy;void Awake(){if(cam==null)cam=Camera.main;if(cam!=null)baseColor=cam.backgroundColor;}void OnCollisionEnter2D(Collision2D c){Hit(c.collider);}void OnTriggerEnter2D(Collider2D c){Hit(c);}void Hit(Collider2D c){for(int i=0;i<deadlyColliders.Length;i++){if(deadlyColliders[i]==c){GoRed();return;}}}void GoRed(){if(busy||cam==null)return;busy=true;cam.backgroundColor=Color.red;if(music!=null)music.Play();StartCoroutine(ShakeAndReset());}IEnumerator ShakeAndReset(){float t=0;Vector3 orig=cam.transform.position;while(t<shakeTime){t+=Time.unscaledDeltaTime;cam.transform.position=orig+(Vector3)(Random.insideUnitCircle*shakePower);yield return null;}cam.transform.position=orig;float tt=0;while(tt<redTime){tt+=Time.unscaledDeltaTime;yield return null;}cam.backgroundColor=baseColor;busy=false;}}

